<div class="container">
    <div class="row">
        <div class="col-md-3">
            <%= render 'books/home', user: @user, booker: @booker %>
        </div>
        <div class="col-md-8 offset-md-1">
            <h1>Book detail</h1>
            <table class="table container">
                <tbody>
                <tr class="row">
                    <td class="col-lg-1">
                        <%= link_to user_path(@user.id) do %>
                            <%= attachment_image_tag @user, :profile_image, :fill, 40, 40, format:'jpeg', fallback:"no_image.jpg", size:'40x40' %>
                        <% end %>
                        <div>
                            <%= link_to @user.name, user_path(@user.id) %>
                        </div>
                    </td>
                    <td class="col-lg-3"><%= link_to @book.title, book_path(@book.id) %></td>
                    <td class="col-lg-2" style="word-wrap:break-word"><%= @book.body %></td>
                    <td class="col-lg-1">
                        <% if @book.favorited_by?(current_user) %>
							<%= link_to book_favorite_path(@book), method: :delete do %>
								<span class="heart" style="color:red">♥<%= @book.favorites.count %></span>
							<% end %>
						<% else %>
							<%= link_to book_favorite_path(@book), method: :post do %>
								♥<%= @book.favorites.count %>
							<% end %>
						<% end %>
                    </td>
                    <td class="col-lg-3">コメント数：<%= @book.book_comments.count %></td>
                    <% if @user.id == current_user.id %>
                        <td class="col-lg-1 d-flex h-25">
                            <%= link_to 'Edit', edit_book_path(@book.id), class: "btn btn-success btn-sm" %>
                        </td>
                        <td class="col-lg-1 d-flex h-25">
                            <%= link_to 'Destroy', "/books/#{@book.id}", method: :delete, "data-confirm"=>"本当に消しますか？", class: "btn btn-danger btn-sm" %>
                        </td>
                    <% end %>
                </tr>
                </tbody>
            </table>
            <table>
                <tbody>
                <% @comments.each do |comment| %>
                    <tr>
                        <td>
                            <%= link_to user_path(comment.user_id) do %>
                            <%= attachment_image_tag comment.user, :profile_image, :fill, 50, 50, format:'jpeg', fallback: "no_image.jpg", size: '40x40'  %>
                            <div><%= comment.user.name %></div>
                            <% end %>
                        </td>
                        <td><%= comment.comment %></td>
                        <% if comment.user.id == current_user.id %>
                            <td><%= link_to 'Destroy', book_book_comment_path(comment.book_id, comment.id), method: :delete, "data-confirm"=>"本当に消しますか？", class: "btn btn-danger btn-sm" %></td>
                        <% else %>
                            <td></td>
                        <% end %>
                    </tr>
                <% end %>
                </tbody>
            </table>
            <%= form_with(model:[@book, @post_comment], local:true) do |f| %>
                <p><%= f.text_area :comment, size:"80x5" %></p>
                <p><%= f.submit '送信' %></p>
            <% end %>
        </div>
    </div>
</div>